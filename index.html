<!-- filepath: investment-calculator/index.html -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>ğŸ’¸ Calculadora de retorno de pÃ©rdidas/ganancias | ğŸ“ˆ GrÃ¡fico TradingView</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1 style="text-align:center; margin-top:32px;">ğŸ’¸ Calculadora de retorno de pÃ©rdidas/ganancias ğŸ“Š</h1>
<div class="selector-center">  
  <div class="selector-wrapper">
   <label for="moneda">ğŸª™ Â¿QuÃ© moneda querÃ©s invertir? ğŸª™</label>
   <select id="moneda">
    <option value="BTCUSDT">Bitcoin (BTC)</option>
    <option value="ETHUSDT">Ethereum (ETH)</option>
    <option value="SANDUSDT">The Sandbox (SAND)</option>
    <option value="DOTUSDT">Polkadot (DOT)</option>
    <option value="SOLUSDT">Solana (SOL)</option>
    <option value="AAVEUSDT">Aave (AAVE)</option>
   </select>
   </div>
 </div>
  <div class="main-wrapper">
    <div></div> <!-- Columna vacÃ­a para empujar la calculadora a la derecha -->
    <div class="container">
      <h2>ğŸ’¸ Calculadora de InversiÃ³n</h2>
      <h3 style="margin-bottom:16px;">ğŸ“ Datos a ingresar</h3>
      <form id="form-calculadora" onsubmit="event.preventDefault(); calcular();">
        <label for="entrada">ğŸ”½ Precio de entrada:</label>
        <input type="number" id="entrada" step="0.01">

        <label for="salida">ğŸ”¼ Precio de salida:</label>
        <input type="number" id="salida" step="0.01">

        <label for="posicion">ğŸ’µ PosiciÃ³n en dÃ³lares:</label>
        <input type="number" id="posicion" step="0.01">

        <button type="submit">ğŸ§® Calcular</button>
        <div id="resultado"></div>
        <button id="limpiar" type="button" style="margin-top:12px; display:none;" onclick="limpiarCampos()">ğŸ”„ Limpiar</button>
      </form>
    </div>
    <div class="chart-wrapper">
      <h3>ğŸ“Š GrÃ¡fico de TradingView</h3>
      <div class="tradingview-widget-container">
        <div id="tradingview_12345"></div>
        <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
        <script type="text/javascript">
          new TradingView.widget({
            "width": 600,
            "height": 400,
            "symbol": "BINANCE:BTCUSDT", // GrÃ¡fico de Bitcoin
            "interval": "D",
            "timezone": "Etc/UTC",
            "theme": "light",
            "style": "1",
            "locale": "es",
            "toolbar_bg": "#f1f3f6",
            "enable_publishing": false,
            "allow_symbol_change": true,
            "container_id": "tradingview_12345"
          });
        </script>
      </div>
    </div>
  </div>
  <div style="text-align:center; margin-top:32px;">
    <a href="historial.html">
      <button style="padding:12px 32px; font-size:18px; background:#1976d2; color:#fff; border:none; border-radius:8px; cursor:pointer;">
        ğŸ“œ Ver historial de trades
      </button>
    </a>
  </div>
  <script>
    function calcular() {
      const entrada = parseFloat(document.getElementById("entrada").value);
      const salida = parseFloat(document.getElementById("salida").value);
      const posicion = parseFloat(document.getElementById("posicion").value);
      const par = document.getElementById("moneda").value;
      if (isNaN(entrada) || isNaN(salida) || isNaN(posicion) || entrada <= 0 || salida <= 0 || posicion <= 0) {
        alert("Por favor, ingrese valores vÃ¡lidos.");
        return;
      }

      const unidades = posicion / entrada;
      const valorFinal = unidades * salida;
      const ganancia = valorFinal - posicion;
      const roi = (ganancia / posicion) * 100;

      let mensaje = "";
      if (roi > 0) {
        mensaje = "âœ… Ganancia realizada";
      } else if (roi === 0) {
        mensaje = "ğŸ”„ Precio de entrada realizado";
      } else {
        mensaje = "âŒ PÃ©rdida realizada";
      }

      const resultadoHTML = `
        <h4 style="margin-bottom:10px;">${mensaje}</h4>
        <p>ğŸ”¢ Unidades compradas: ${unidades.toFixed(2)}</p>
        <p>ğŸ’° Valor final: $${valorFinal.toFixed(2)}</p>
        <p>${ganancia >= 0 ? "ğŸ“ˆ" : "ğŸ“‰"} Ganancia/PÃ©rdida: $${ganancia.toFixed(2)}</p>
        <p>ğŸ“Š ROI: ${roi.toFixed(2)}%</p>
      `;
      document.getElementById("resultado").innerHTML = resultadoHTML;
      document.getElementById("limpiar").style.display = "block";

      // Guardar el trade en el historial (localStorage)
      const trade = {
        entrada,
        salida,
        posicion,
        unidades: unidades.toFixed(2),
        valorFinal: valorFinal.toFixed(2),
        ganancia: ganancia.toFixed(2),
        roi: roi.toFixed(2),
        fecha: new Date().toLocaleString(),
        par
      };

      let historial = JSON.parse(localStorage.getItem("historialTrades")) || [];
      historial.push(trade);
      localStorage.setItem("historialTrades", JSON.stringify(historial));
    }

    function limpiarCampos() {
      document.getElementById("entrada").value = "";
      document.getElementById("salida").value = "";
      document.getElementById("posicion").value = "";
      document.getElementById("resultado").innerHTML = "";
      document.getElementById("limpiar").style.display = "none";
    }
  </script>
</body>
</html>