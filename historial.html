<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>📜 Historial de Trades</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      background-image: url('fondo.png'); /* Cambia esto a la ruta de tu imagen */
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      height: 100vh;
      margin: 0;
    }
    .footer {
      background-color: rgba(51, 51, 51, 0.8); /* Fondo semi-transparente */
      color: #fff;
      text-align: center;
      padding: 10px 0;
      position: relative;
      bottom: 0;
      width: 100%;
    }
  </style>  
</head>
<body>
  <h1 style="text-align:center; margin-top:32px;">📜 Historial de Trades</h1>
  <div class="historial-table-container">
    <table>
      <thead>
        <tr>
          <th>Fecha</th>
          <th>Par</th>
          <th>Entrada</th>
          <th>Salida</th>
          <th>Posición</th>
          <th>Unidades</th>
          <th>Valor Final</th>
          <th>Ganancia</th>
          <th>ROI (%)</th>
        </tr>
      </thead>
      <tbody id="tabla-historial"></tbody>
    </table>
    <button onclick="borrarHistorial()" style="margin-top:20px;">🗑️ Borrar historial</button>
  </div>

  <!-- Formulario para enviar historial por EmailJS -->
<div style="margin-top:32px; text-align:center;">
  <label for="correo">📬 Ingresá tu email:</label><br>
  <input type="email" id="correo" placeholder="tucorreo@ejemplo.com" style="padding:8px; margin:12px; border-radius:6px; border:1px solid #ccc; width:260px;"><br>

  <label for="mensaje">💬 Mensaje adicional:</label><br>
  <textarea id="mensaje" rows="4" placeholder="Escribí un mensaje si querés..." style="width:300px; padding:8px; border-radius:6px; border:1px solid #ccc;"></textarea><br>

  <button onclick="enviarEmailHistorial()" style="margin-top:12px; padding:10px 24px; background:#2196f3; color:#fff; border:none; border-radius:6px; cursor:pointer;">
    📤 Enviar historial por EmailJS
  </button>
</div>
 
  </div>
  <h2 style="text-align:center; margin-top:48px;">📊 Porcentaje total de ganancia/pérdida por cada par</h2>
  <div class="summary-grid" id="summary-grid"></div>
  
  <script>
    function cargarHistorial() {
      const historial = JSON.parse(localStorage.getItem("historialTrades")) || [];
      const tabla = document.getElementById("tabla-historial");
      tabla.innerHTML = "";
      const resumen = {};

      historial.forEach(trade => {
        tabla.innerHTML = `
          <tr>
            <td>${trade.fecha}</td>
            <td>${trade.par}</td>
            <td>${trade.entrada}</td>
            <td>${trade.salida}</td>
            <td>${trade.posicion}</td>
            <td>${trade.unidades}</td>
            <td>${trade.valorFinal}</td>
            <td>${trade.ganancia}</td>
            <td>${trade.roi}</td>
          </tr>
        ` + tabla.innerHTML;

        // Acumula ROI por par
        if (!resumen[trade.par]) resumen[trade.par] = { totalGanancia: 0, totalPosicion: 0, cantidad: 0 };
        resumen[trade.par].totalGanancia += parseFloat(trade.ganancia);
        resumen[trade.par].totalPosicion += parseFloat(trade.posicion);
        resumen[trade.par].cantidad += 1;
      });

      // Muestra el resumen por par
      const summaryGrid = document.getElementById("summary-grid");
      summaryGrid.innerHTML = "";
      Object.keys(resumen).forEach(par => {
        const total = resumen[par].totalGanancia;
        const totalPos = resumen[par].totalPosicion;
        let porcentaje = totalPos !== 0 ? (total / totalPos) * 100 : 0;
        let clase = porcentaje > 0 ? "positivo" : (porcentaje < 0 ? "negativo" : "neutro");
        summaryGrid.innerHTML += `
          <div class="summary-card ${clase}">
            <div>🔗 <b>${par}</b></div>
            <div>${porcentaje >= 0 ? "📈" : "📉"} ${porcentaje.toFixed(2)}%</div>
            <div>Operaciones: ${resumen[par].cantidad}</div>
          </div>
        `;
      });
    }
    function borrarHistorial() {
      localStorage.removeItem("historialTrades");
      cargarHistorial();
    }
    function enviarPorMail() {
      const historial = JSON.parse(localStorage.getItem("historialTrades")) || [];
      if (historial.length === 0) {
        alert("No hay historial para enviar.");
        return;
      }

      let cuerpo = "📜 Historial de Trades:\n\n";
      historial.forEach(trade => {
        cuerpo += `Fecha: ${trade.fecha}\nPar: ${trade.par}\nEntrada: ${trade.entrada}\nSalida: ${trade.salida}\nPosición: ${trade.posicion}\nUnidades: ${trade.unidades}\nValor Final: ${trade.valorFinal}\nGanancia: ${trade.ganancia}\nROI: ${trade.roi}%\n\n`;
      });

      const asunto = "Historial de Trades";
      const destinatario = ""; // ← Podés predefinir uno si querés
      const mailtoLink = `mailto:${destinatario}?subject=${encodeURIComponent(asunto)}&body=${encodeURIComponent(cuerpo)}`;

      window.location.href = mailtoLink;
    }
    cargarHistorial();
  </script>
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script>
    function enviarEmailHistorial() {
    const correo = document.getElementById("correo").value.trim();
    const mensaje = document.getElementById("mensaje").value.trim();
    const historial = JSON.parse(localStorage.getItem("historialTrades")) || [];

    if (!correo) {
      alert("Por favor ingresá un correo válido.");
      return;
    }
    if (historial.length === 0) {
      alert("No hay historial para enviar.");
      return;
    }

    let contenido = "";
    historial.forEach(trade => {
      contenido += `Fecha: ${trade.fecha}\nPar: ${trade.par}\nEntrada: ${trade.entrada}\nSalida: ${trade.salida}\nPosición: ${trade.posicion}\nUnidades: ${trade.unidades}\nValor Final: ${trade.valorFinal}\nGanancia: ${trade.ganancia}\nROI: ${trade.roi}%\n\n`;
    });

    const datosEmail = {
      correo: correo,
      fecha_envio: new Date().toLocaleString(),
      contenido_historial: contenido,
      mensaje_usuario: mensaje || "Sin mensaje adicional"
    };

    emailjs.send("service_huyst8i", "template_67r20oq", datosEmail , "pFCM1LSEP1taIbh0X")
      .then(() => {
        alert("📧 Historial enviado exitosamente a " + correo);
      })
      .catch(error => {
        console.error("Error al enviar email:", error);
        alert("❌ Hubo un problema al enviar el correo.");
      });
  }
window.enviarEmailHistorial = enviarEmailHistorial;  
</script>
<footer style="text-align:center; padding:2px; background-color:#f1f1f1">
    <a href="index.html" style="text-decoration:none; color:#adb9c2ef;">🔙 Volver a la página principal</a>
  </footer>
</body>
</html>